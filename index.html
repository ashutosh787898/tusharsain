<?php
$result = null;
$error = null;

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $input = strtoupper(trim($_POST['sequence'] ?? ''));

    // Validation
    if (!preg_match('/^[TD]{3,}$/', $input)) {
        $error = "Please enter at least 3 characters using only T and D.";
    } else {

        $pairs = [];
        $length = strlen($input);

        // Build pattern frequency table
        for ($i = 0; $i < $length - 2; $i++) {
            $pair = $input[$i] . $input[$i + 1];
            $next = $input[$i + 2];

            if (!isset($pairs[$pair])) {
                $pairs[$pair] = ['T' => 0, 'D' => 0];
            }
            $pairs[$pair][$next]++;
        }

        // Get last pair
        $lastPair = $input[$length - 2] . $input[$length - 1];

        if (isset($pairs[$lastPair])) {
            $tCount = $pairs[$lastPair]['T'];
            $dCount = $pairs[$lastPair]['D'];
            $total = $tCount + $dCount;

            if ($total > 0) {
                $tProb = round(($tCount / $total) * 100, 2);
                $dProb = round(($dCount / $total) * 100, 2);

                $prediction = $tCount >= $dCount ? 'T' : 'D';

                $result = [
                    'pair' => $lastPair,
                    'prediction' => $prediction,
                    'tProb' => $tProb,
                    'dProb' => $dProb
                ];
            } else {
                $error = "Not enough data to predict.";
            }
        } else {
            $error = "Pattern not found in history.";
        }
    }
}
?>
<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>T/D Pattern Predictor</title>
<style>
body {
    font-family: Arial, sans-serif;
    background: #f4f6fb;
    margin: 0;
    padding: 40px;
}
.container {
    max-width: 600px;
    margin: auto;
    background: #fff;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.08);
}
h1 {
    margin-top: 0;
    text-align: center;
}
input[type=text] {
    width: 100%;
    padding: 12px;
    font-size: 16px;
    margin-top: 10px;
}
button {
    margin-top: 15px;
    width: 100%;
    padding: 12px;
    font-size: 16px;
    background: #0b6ef6;
    color: #fff;
    border: none;
    border-radius: 6px;
    cursor: pointer;
}
button:hover {
    background: #095bd3;
}
.result {
    margin-top: 20px;
    padding: 15px;
    border-radius: 8px;
    background: #f0f8ff;
}
.error {
    margin-top: 20px;
    padding: 15px;
    border-radius: 8px;
    background: #ffe5e5;
    color: #a00;
}
.stat {
    font-size: 18px;
    margin: 5px 0;
}
.highlight {
    font-weight: bold;
    font-size: 22px;
}
</style>
</head>
<body>

<div class="container">
<h1>T / D Pattern Predictor</h1>

<form method="post">
    <label>Enter sequence (T and D only):</label>
    <input type="text" name="sequence" placeholder="Example: TTDTTTDDTTT" required>
    <button type="submit">Analyze & Predict</button>
</form>

<?php if ($error): ?>
    <div class="error"><?php echo htmlspecialchars($error); ?></div>
<?php endif; ?>

<?php if ($result): ?>
    <div class="result">
        <div class="stat">Last Pattern: <b><?php echo $result['pair']; ?></b></div>
        <div class="stat">Probability T: <?php echo $result['tProb']; ?>%</div>
        <div class="stat">Probability D: <?php echo $result['dProb']; ?>%</div>
        <div class="stat highlight">
            Predicted Next Outcome: <?php echo $result['prediction']; ?>
        </div>
    </div>
<?php endif; ?>

</div>

</body>
</html>
